name: C/C++ CI

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build-chain:
    strategy:
      matrix:
        include:
        - arch : amd64 
        - arch : arm64
    runs-on: ubuntu-latest
    steps:
    -
      name: "Ubuntu update"
      run: |
        sudo apt update
        sudo apt install check autopoint flex help2man
    -
      name: "libDAQ, the Data AcQuisition Library"
      run: |
        git clone --recurse-submodules --branch=v3.0.12 --depth=1 https://github.com/snort3/libdaq.git
        cd libdaq && ./bootstrap && ./configure --prefix=target && make -j && sudo make install && make clean
        ls && ls target
    -
      name: "libdnet, the interface to several low-level networking routines"
      run: |
        git clone --recurse-submodules --branch=libdnet-1.16.4 --depth=1 https://github.com/ofalk/libdnet.git
        cd libdnet && ./configure && make -j && sudo make install && make clean
    -
      name: "flex, the fast lexical analyzer generator"
      run: |
        git clone --recurse-submodules --branch=v2.6.4 --depth=1 https://github.com/westes/flex.git
        cd flex && ./autogen.sh && ./configure && make -j check && sudo make install && make clean
    -
      name: "hwloc, discovering hardware resources in parallel architectures."
      run: |
        git clone --recurse-submodules --branch=hwloc-2.9.2 --depth=1 https://github.com/open-mpi/hwloc.git
        cd hwloc && ./autogen.sh && ./configure && make -j && sudo make install && make clean
    -
      name: "LuaJIT is a Just-In-Time (JIT) compiler for the Lua programming language."
      run: |
        git clone --recurse-submodules --branch=v2.1.ROLLING --depth=1 https://github.com/LuaJIT/LuaJIT.git
        cd LuaJIT && make -j && sudo make install && make clean
    -
      name: "libpcap, framework for low-level network monitoring"
      run: |
        git clone --recurse-submodules --branch=libpcap-1.10.4 --depth=1 https://github.com/the-tcpdump-group/libpcap
        cd libpcap && ./configure && make -j && sudo make install && make clean
    -
      name: "PCRE2, Perl-Compatible Regular Expressions"
      run: |
        git clone --recurse-submodules --branch=pcre2-10.42 --depth=1 https://github.com/PCRE2Project/pcre2.git
        cd pcre2 && ./autogen.sh && ./configure && make -j && sudo make install && make clean
        
  #build-snort:
  #  needs: build-dependencies
  #  runs-on: ubuntu-latest
  #  steps:
    - 
      name: "snort3, the next generation Snort IPS (Intrusion Prevention System)"
      run: |
        git clone --recurse-submodules --depth=1 https://github.com/snort3/snort3.git
        cd snort3 && ./configure_cmake.sh && cd build && make -j 4 && sudo make install && make clean
